---
shortcuts: []
state:
  smState: send_email
  error: null
  nuevaContrasena: null
  nuevaContrasena2: null
  hashcode: null
bunch:
  onInit:
    - _type: set
      path: hashcode
      value:
        payloadPath: hash
    - _type: grape
      condition:
        operator: A is defined
        A:
          payloadPath: hash
      name: iniciaEstadoEstableceContrasena
  iniciaEstadoEstableceContrasena:
    - _type: smTransition
      current: send_email
      target: check_hash_link
    - _type: get
      schema: checkHashlink
      id:
        payloadPath: hash
      action: forgot_password
      success: hashLinkCorrecto
      error: hashLinkIncorrecto
  hashLinkIncorrecto:
    - _type: alert
      text: Error al comprobar el enlace
      severity: error
    - _type: smTransition
      current: check_hash_link
      target: hash_incorrecto
  hashLinkCorrecto:
    - _type: smTransition
      current: check_hash_link
      target: establecer_nueva_contrasena
  onEnviarCorreoClicked:
    - _type: post
      schema: forgotPassword
      success: onEmailSent
      error: onSendEmailFailed
      data:
        - key: email
          value:
            statePath: email
  onSendEmailFailed:
    - _type: smTransition
      current: send_email
      target: send_email_failed
    - _type: set
      path: error
      value:
        payloadPath: response
  onEmailSent:
    - _type: smTransition
      current: send_email
      target: email_sent
  onCambiarContrasenaClicked:
    - _type: post
      schema: changePassword
      data:
        - key: action
          value:
            const: change_password
        - key: hashcode
          value:
            statePath: hashcode
        - key: password
          value:
            statePath: nuevaContrasena
      success: onContrasenaCambiada
  onContrasenaCambiada:
    - _type: smTransition
      current: establecer_nueva_contrasena
      target: contrasena_cambiada
